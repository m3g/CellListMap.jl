<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ParticleSystem · CellListMap.jl</title><meta name="title" content="ParticleSystem · CellListMap.jl"/><meta property="og:title" content="ParticleSystem · CellListMap.jl"/><meta property="twitter:title" content="ParticleSystem · CellListMap.jl"/><meta name="description" content="Documentation for CellListMap.jl."/><meta property="og:description" content="Documentation for CellListMap.jl."/><meta property="twitter:description" content="Documentation for CellListMap.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="CellListMap.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="CellListMap.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CellListMap.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Overview</a></li><li><a class="tocitem" href="../../neighborlists/">Neighbor lists</a></li><li class="is-active"><a class="tocitem" href>ParticleSystem</a><ul class="internal"><li><a class="tocitem" href="#The-mapped-function"><span>The mapped function</span></a></li><li><a class="tocitem" href="#The-ParticleSystem-constructor"><span>The ParticleSystem constructor</span></a></li><li><a class="tocitem" href="#ParticleSystemPositions"><span>The <code>ParticleSystemPositions</code> type</span></a></li></ul></li><li><a class="tocitem" href="../single_set_simple/">Single set: Simple outputs</a></li><li><a class="tocitem" href="../single_set_compound/">Single set: Compound outputs</a></li><li><a class="tocitem" href="../two_sets/">Two sets of particles</a></li><li><a class="tocitem" href="../updating/">Updating the system</a></li><li><a class="tocitem" href="../options/">Options</a></li><li><a class="tocitem" href="../examples/">Complete examples</a></li><li><a class="tocitem" href="../../unitcell/">Unitcell requirements</a></li><li><a class="tocitem" href="../../ecosystem/">Ecosystem integration</a></li><li><a class="tocitem" href="../../API/">Public Interface</a></li><li><a class="tocitem" href="../../citation/">Citation</a></li><li><a class="tocitem" href="../../migrating/">Migrating from 0.9</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>ParticleSystem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ParticleSystem</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/m3g/CellListMap.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/m3g/CellListMap.jl/blob/main/docs/src/ParticleSystem/introduction.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ParticleSystem-interface"><a class="docs-heading-anchor" href="#ParticleSystem-interface">ParticleSystem interface</a><a id="ParticleSystem-interface-1"></a><a class="docs-heading-anchor-permalink" href="#ParticleSystem-interface" title="Permalink"></a></h1><h2 id="The-mapped-function"><a class="docs-heading-anchor" href="#The-mapped-function">The mapped function</a><a id="The-mapped-function-1"></a><a class="docs-heading-anchor-permalink" href="#The-mapped-function" title="Permalink"></a></h2><p>The purpose of CellListMap is to compute a pairwise-dependent function for all pairs of particles that are closer to each other than a defined cutoff. This pairwise function must be implemented by the user and adhere to the following interface:</p><pre><code class="language-julia hljs">function f(pair, output)
    (; i, j, x, y, d2, d) = pair
    # update output variable using above pair data
    return output
end</code></pre><p>where <code>pair</code> is a <code>NeighborPair</code> object, containing fields <code>i</code>, <code>j</code>, <code>x</code>, <code>y</code>, <code>d2</code> and <code>d</code>, which here we extract from the object using <a href="https://docs.julialang.org/en/v1/manual/functions/#Property-destructuring">destructuring syntax</a>. </p><p><code>x</code> and <code>y</code> are the positions of the particles, already wrapped relative to each other according to the periodic boundary conditions (a minimum-image set of positions), <code>i</code> and <code>j</code> are the indexes of the particles in the arrays of coordinates, <code>d2</code> is the squared distance between the particles, <code>d</code> is the distance, and <code>output</code> is the variable to be computed. </p><div class="admonition is-info" id="Info-6ab214558e6a90ad"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-6ab214558e6a90ad" title="Permalink"></a></header><div class="admonition-body"><h4>Details of the mapped function interface</h4><p>The <code>pair</code> input of the function contains the  data that the user may use to update the <code>output</code> variable. The <code>NeighborPair</code> object contains fields <code>x</code>, <code>y</code>, <code>i</code>, <code>j</code>, <code>d2</code> and the lazily computed <code>d</code>, meaning:</p><table><tr><th style="text-align: center">Input/Output</th><th style="text-align: center">Type</th><th style="text-align: left">Meaning</th></tr><tr><td style="text-align: center"><code>x</code></td><td style="text-align: center"><code>SVector</code></td><td style="text-align: left">The coordinates of particle <code>i</code> of the pair.</td></tr><tr><td style="text-align: center"><code>y</code></td><td style="text-align: center"><code>SVector</code></td><td style="text-align: left">The coordinates of particle <code>j</code> of the pair (minimum-image relative to <code>x</code>).</td></tr><tr><td style="text-align: center"><code>i</code></td><td style="text-align: center"><code>Int</code></td><td style="text-align: left">Index of first particle in the original array of coordinates.</td></tr><tr><td style="text-align: center"><code>j</code></td><td style="text-align: center"><code>Int</code></td><td style="text-align: left">Index of second particle in the original array of coordinates.</td></tr><tr><td style="text-align: center"><code>d2</code></td><td style="text-align: center"><code>&lt;:Real</code></td><td style="text-align: left">Squared distance between the particles.</td></tr><tr><td style="text-align: center"><code>d</code></td><td style="text-align: center"><code>&lt;:Real</code></td><td style="text-align: left">Squared distance between the particles (computed lazily).</td></tr><tr><td style="text-align: center"><code>output</code></td><td style="text-align: center">user defined</td><td style="text-align: left">the name of the variable to be updated.</td></tr></table><p><strong>Notes:</strong> <code>x</code> and <code>y</code> may be 2D or 3D vectors, depending on the dimension of the system. The type of the coordinates of <code>x</code>, <code>y</code>, and of <code>d2</code> are dependent on the input arrays and cutoff, and can be <code>Float64</code>, <code>Float32</code>, unitful quantities, etc.</p><table><tr><th style="text-align: center">Return value</th><th style="text-align: center">Type</th><th style="text-align: left">Meaning</th></tr><tr><td style="text-align: center"><code>output</code></td><td style="text-align: center">user defined</td><td style="text-align: left">the updated value of output.</td></tr></table><p>The <code>output</code> variable <strong>must</strong> be returned by the function, being it mutable or immutable.</p></div></div><h3 id="Basic-examples"><a class="docs-heading-anchor" href="#Basic-examples">Basic examples</a><a id="Basic-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-examples" title="Permalink"></a></h3><p>For example, computing the energy, as the sum of the inverse of the distance between particles, can be done with a function like:</p><pre><code class="language-julia hljs">function energy(pair, u)
    u += 1 / pair.d
    return u
end</code></pre><p>and this function is passed directly to <code>pairwise!</code>:</p><pre><code class="language-julia hljs">u = pairwise!(energy, system)</code></pre><p>(what <code>system</code> is will be explained in the examples below). Note that the <code>energy</code> function only uses <code>pair.d</code> (the distance), but all other fields (<code>pair.x</code>, <code>pair.y</code>, <code>pair.i</code>, <code>pair.j</code>, <code>pair.d2</code>) are available.</p><p>Alternatively, the function might require additional parameters, such as the masses of the particles. In this case, we can use a closure to provide such data:</p><pre><code class="language-julia hljs">function energy(pair, u, masses)
    (; i, j, d)  = pair 
    u += masses[i]*masses[j] / d
    return u
end
const masses = # ... some masses
u = pairwise!((pair, u) -&gt; energy(pair, u, masses), system)</code></pre><p>Here we reinforce the fact that the <code>energy</code> functions defined above compute the contribution to the energy of the interaction of <em>a single</em> pair of particles. This function will be called for every pair of particles within the cutoff, automatically, in the <code>pairwise!</code> call.</p><div class="admonition is-info" id="Note-5f4dc598043e1859"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-5f4dc598043e1859" title="Permalink"></a></header><div class="admonition-body"><p>The <code>output</code> of the <code>CellListMap</code> computation may be of any kind. Most commonly, it is an energy, a set of forces, or other data type that can be represented either as a number, an array of numbers, or an array of vectors (<code>SVectors</code> in particular), such as an arrays of forces.</p><p>Additionally, the properties are frequently additive (the energy is the sum of the energy of the particles, or the forces are added by summation).</p><p>For these types of <code>output</code> data the usage does not require the implementation of any data-type dependent function.</p></div></div><h2 id="The-ParticleSystem-constructor"><a class="docs-heading-anchor" href="#The-ParticleSystem-constructor">The ParticleSystem constructor</a><a id="The-ParticleSystem-constructor-1"></a><a class="docs-heading-anchor-permalink" href="#The-ParticleSystem-constructor" title="Permalink"></a></h2><p>The <code>ParticleSystem</code> constructor receives the properties of the system and sets up automatically the most commonly used data structures necessary.</p><div class="admonition is-info" id="Note-6ec68168943735fd"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-6ec68168943735fd" title="Permalink"></a></header><div class="admonition-body"><ul><li>Systems can be 2 or 3-dimensional.</li><li>The <code>unitcell</code> parameter may be:<ul><li>a vector, in which case the system periodic boundaries are Orthorhombic, this is faster.</li><li>a matrix, in which case the system periodic boundaries are Triclinic (general). The lattice vectors correspond to the <em>columns</em> of the matrix.</li><li><code>nothing</code> (by default), in which case no periodic boundary conditions will be used.</li></ul></li><li><code>Unitful</code> quantities can be provided, given appropriate types for all input parameters.</li></ul></div></div><h2 id="ParticleSystemPositions"><a class="docs-heading-anchor" href="#ParticleSystemPositions">The <code>ParticleSystemPositions</code> type</a><a id="ParticleSystemPositions-1"></a><a class="docs-heading-anchor-permalink" href="#ParticleSystemPositions" title="Permalink"></a></h2><p>The positions stored in a <code>ParticleSystem</code> (accessible via <code>system.xpositions</code> and, for two-set systems, <code>system.ypositions</code>) are of type <code>ParticleSystemPositions{N,T}</code>. This is a wrapper around a <code>Vector{SVector{N,T}}</code> that carries an internal <code>updated</code> flag. When coordinates are mutated through the supported interface, the flag is set automatically, so that cell lists are recomputed on the next call to <code>pairwise!</code>.</p><p>A <code>ParticleSystemPositions</code> can be constructed from a vector of vectors (e.g. <code>Vector{Vector{Float64}}</code>), but typically this construction occurs only internal on the call to <code>ParticleSystem</code>. The mutation interface is important when the user wants to vary the coordinates of the system. Mutation must strictly follow the available API methods, otherwise subsequent computations might be wrong because they can be based on outdated cell lists.  </p><h3 id="Mutating-interface"><a class="docs-heading-anchor" href="#Mutating-interface">Mutating interface</a><a id="Mutating-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Mutating-interface" title="Permalink"></a></h3><p>The following functions mutate the positions <strong>and</strong> flag the array as updated, triggering recomputation of the cell lists on the next <code>pairwise!</code> call:</p><table><tr><th style="text-align: left">Function</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>setindex!</code></td><td style="text-align: left">Set the position of a single particle by index</td></tr><tr><td style="text-align: left"><code>empty!</code></td><td style="text-align: left">Remove all positions</td></tr><tr><td style="text-align: left"><code>resize!</code></td><td style="text-align: left">Resize the number of positions</td></tr><tr><td style="text-align: left"><code>append!</code></td><td style="text-align: left">Append positions from another collection</td></tr><tr><td style="text-align: left"><code>push!</code></td><td style="text-align: left">Append positions from another collection</td></tr><tr><td style="text-align: left">Broadcasting</td><td style="text-align: left">In-place broadcast (e.g. <code>p .= new_positions</code>)</td></tr><tr><td style="text-align: left"><code>view</code></td><td style="text-align: left">Views share the updated state of the original array, such that mutations to views are tracked.</td></tr></table><h3 id="Read-only-interface"><a class="docs-heading-anchor" href="#Read-only-interface">Read-only interface</a><a id="Read-only-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Read-only-interface" title="Permalink"></a></h3><table><tr><th style="text-align: left">Function</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>getindex</code></td><td style="text-align: left">Retrieve the position of a particle by index</td></tr><tr><td style="text-align: left"><code>length</code></td><td style="text-align: left">Number of particles</td></tr><tr><td style="text-align: left"><code>size</code></td><td style="text-align: left">Size tuple <code>(length,)</code></td></tr><tr><td style="text-align: left"><code>axes</code></td><td style="text-align: left">Index axes of the underlying vector</td></tr><tr><td style="text-align: left"><code>keys</code></td><td style="text-align: left">Linear indices</td></tr><tr><td style="text-align: left"><code>eachindex</code></td><td style="text-align: left">Iterator over valid indices</td></tr><tr><td style="text-align: left"><code>firstindex</code></td><td style="text-align: left">First valid index</td></tr><tr><td style="text-align: left"><code>lastindex</code></td><td style="text-align: left">Last valid index</td></tr><tr><td style="text-align: left"><code>first</code></td><td style="text-align: left">First position</td></tr><tr><td style="text-align: left"><code>last</code></td><td style="text-align: left">Last position</td></tr><tr><td style="text-align: left"><code>ndims</code></td><td style="text-align: left">Always returns <code>1</code></td></tr><tr><td style="text-align: left"><code>iterate</code></td><td style="text-align: left">Iteration protocol</td></tr><tr><td style="text-align: left"><code>copy</code></td><td style="text-align: left">Shallow copy (preserves <code>updated</code> flag)</td></tr><tr><td style="text-align: left"><code>similar</code></td><td style="text-align: left">Allocate an uninitialized array of same shape</td></tr><tr><td style="text-align: left"><code>view</code></td><td style="text-align: left">Create a view sharing the <code>updated</code> flag</td></tr></table></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../neighborlists/">« Neighbor lists</a><a class="docs-footer-nextpage" href="../single_set_simple/">Single set: Simple outputs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 20 February 2026 12:33">Friday 20 February 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
