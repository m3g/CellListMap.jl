<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Options · CellListMap.jl</title><meta name="title" content="Options · CellListMap.jl"/><meta property="og:title" content="Options · CellListMap.jl"/><meta property="twitter:title" content="Options · CellListMap.jl"/><meta name="description" content="Documentation for CellListMap.jl."/><meta property="og:description" content="Documentation for CellListMap.jl."/><meta property="twitter:description" content="Documentation for CellListMap.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="CellListMap.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="CellListMap.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CellListMap.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Overview</a></li><li><a class="tocitem" href="../../neighborlists/">Neighbor lists</a></li><li><a class="tocitem" href="../introduction/">ParticleSystem</a></li><li><a class="tocitem" href="../single_set_simple/">Single set: Simple outputs</a></li><li><a class="tocitem" href="../single_set_compound/">Single set: Compound outputs</a></li><li><a class="tocitem" href="../two_sets/">Two sets of particles</a></li><li><a class="tocitem" href="../updating/">Updating the system</a></li><li class="is-active"><a class="tocitem" href>Options</a><ul class="internal"><li><a class="tocitem" href="#Turn-parallelization-on-and-off"><span>Turn parallelization on and off</span></a></li><li><a class="tocitem" href="#Displaying-a-progress-bar"><span>Displaying a progress bar</span></a></li><li><a class="tocitem" href="#Fine-control-of-the-parallelization"><span>Fine control of the parallelization</span></a></li><li><a class="tocitem" href="#Avoid-cell-list-updating"><span>Avoid cell list updating</span></a></li><li><a class="tocitem" href="#Control-CellList-cell-size"><span>Control CellList cell size</span></a></li><li><a class="tocitem" href="#Coordinates-as-matrices"><span>Coordinates as matrices</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Complete examples</a></li><li><a class="tocitem" href="../../unitcell/">Unitcell requirements</a></li><li><a class="tocitem" href="../../ecosystem/">Ecosystem integration</a></li><li><a class="tocitem" href="../../API/">Public Interface</a></li><li><a class="tocitem" href="../../citation/">Citation</a></li><li><a class="tocitem" href="../../migrating/">Migrating from 0.9</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Options</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Options</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/m3g/CellListMap.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/m3g/CellListMap.jl/blob/main/docs/src/ParticleSystem/options.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Additional-options"><a class="docs-heading-anchor" href="#Additional-options">Additional options</a><a id="Additional-options-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-options" title="Permalink"></a></h1><p>This section covers additional options for fine-tuning the behavior and performance of the <code>ParticleSystem</code> interface.</p><h2 id="Turn-parallelization-on-and-off"><a class="docs-heading-anchor" href="#Turn-parallelization-on-and-off">Turn parallelization on and off</a><a id="Turn-parallelization-on-and-off-1"></a><a class="docs-heading-anchor-permalink" href="#Turn-parallelization-on-and-off" title="Permalink"></a></h2><p>The use of parallel computations can be tunned on and of by the <code>system.parallel</code> boolean flag. For example, using 6 cores (12 threads) for the calculation of the minimum-distance example:</p><pre><code class="language-julia-repl hljs">julia&gt; f(system) = pairwise!(minimum_distance, system)
f (generic function with 1 method)

julia&gt; Threads.nthreads()
8

julia&gt; system.parallel = true
true

julia&gt; @btime f($system)
  268.265 μs (144 allocations: 16.91 KiB)
MinimumDistance(783, 497, 0.007213710914619913)

julia&gt; system.parallel = false
false

julia&gt; @btime f($system)
  720.304 μs (0 allocations: 0 bytes)
MinimumDistance(783, 497, 0.007213710914619913)</code></pre><h2 id="Displaying-a-progress-bar"><a class="docs-heading-anchor" href="#Displaying-a-progress-bar">Displaying a progress bar</a><a id="Displaying-a-progress-bar-1"></a><a class="docs-heading-anchor-permalink" href="#Displaying-a-progress-bar" title="Permalink"></a></h2><p>Displaying a progress bar: for very long runs, the user might want to see the progress of the computation. Use the <code>show_progress</code> keyword parameter of the <code>pairwise!</code> function for that.</p><p>For example, we execute the computation above, but with much more particles:</p><pre><code class="language-julia-repl hljs">julia&gt; xpositions = rand(SVector{3,Float64},10^6);

julia&gt; ypositions = rand(SVector{3,Float64},10^6);

julia&gt; system = ParticleSystem(
                  xpositions = xpositions,
                  ypositions = ypositions,
                  unitcell=[1.0,1.0,1.0],
                  cutoff = 0.1,
                  output = MinimumDistance(0,0,+Inf),
                  output_name = :minimum_distance,
               );

julia&gt; pairwise!(minimum_distance, system; show_progress = true)
Progress:  24%|██████████▏                               |  ETA: 0:00:29</code></pre><p>By activating the <code>show_progress</code> flag, a nice progress bar is shown.</p><h2 id="Fine-control-of-the-parallelization"><a class="docs-heading-anchor" href="#Fine-control-of-the-parallelization">Fine control of the parallelization</a><a id="Fine-control-of-the-parallelization-1"></a><a class="docs-heading-anchor-permalink" href="#Fine-control-of-the-parallelization" title="Permalink"></a></h2><p>The number of batches launched in parallel runs can be tunned by the <code>nbatches</code> keyword parameter of the <code>ParticleSystem</code> constructor. By default, the number of batches is defined as heuristic function dependent on the number of particles, and possibly returns optimal values in most cases. For a detailed discussion about this parameter, see <a href="../../Internals/#Number-of-batches">Number of batches</a>.</p><p>For example, to set the number of batches for cell list calculation to 4 and the number of batches for mapping to 8, we can do:</p><pre><code class="language-julia-repl hljs">julia&gt; system = ParticleSystem(
           xpositions = rand(SVector{3,Float64},1000),
           unitcell=[1,1,1],
           cutoff = 0.1,
           output = 0.0,
           output_name = :energy,
           nbatches=(4,8), # use this keyword
       );</code></pre><p>Most times it is expected that the default parameters are optimal. But particularly for inhomogeneous systems increasing the number of batches of the mapping phase (second parameter of the tuple) may improve the performance by reducing the idle time of threads.</p><p>When the number of batches is left at the default (i.e., <code>nbatches=(0,0)</code> or omitted), it is automatically recomputed whenever <code>UpdateParticleSystem!</code> detects that the number of particles has changed. This allows adding or removing particles from the system without having to manually adjust the parallelization parameters:</p><pre><code class="language-julia-repl hljs">julia&gt; system = ParticleSystem(
           xpositions = rand(SVector{3,Float64}, 1000),
           unitcell = [1,1,1],
           cutoff = 0.1,
           output = 0.0,
           output_name = :energy,
       );

julia&gt; nbatches(system) # default batches for 1000 particles
(2, 4)

julia&gt; system.xpositions = rand(SVector{3,Float64}, 100000); # resize

julia&gt; UpdateParticleSystem!(system); # nbatches recomputed automatically

julia&gt; nbatches(system) # updated for 100000 particles
(8, 32)</code></pre><p>If the number of batches is explicitly set to non-zero values, they will be kept fixed and will not change when the number of particles changes.</p><h2 id="Avoid-cell-list-updating"><a class="docs-heading-anchor" href="#Avoid-cell-list-updating">Avoid cell list updating</a><a id="Avoid-cell-list-updating-1"></a><a class="docs-heading-anchor-permalink" href="#Avoid-cell-list-updating" title="Permalink"></a></h2><p>To compute different properties without recomputing cell lists, use <code>update_lists=false</code> in the call of <code>pairwise</code> methods, for example,</p><pre><code class="language-julia hljs">using CellListMap, StaticArrays
system = ParticleSystem(xpositions=rand(SVector{3,Float64},1000), output=0.0, cutoff=0.1, unitcell=[1,1,1])
# First call, will compute the cell lists
pairwise!((pair, u) -&gt; u += pair.d2, system)
# Second run: do not update the cell lists but compute a different property
pairwise!((pair, u) -&gt; u += pair.d, system; update_lists=false)</code></pre><p>in which case we are computing the sum of distances from the same cell lists used to compute the energy in the previous example (requires version 0.8.9).</p><div class="admonition is-warning" id="Warning-ad88cde008ca330b"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-ad88cde008ca330b" title="Permalink"></a></header><div class="admonition-body"><p><code>update_lists=false</code> will skip the updating of the cell lists, thus be careful to <strong>not</strong> use this option if the coordinates, cutoff, unitcell, or any other property of the system changed.</p></div></div><h2 id="Control-CellList-cell-size"><a class="docs-heading-anchor" href="#Control-CellList-cell-size">Control CellList cell size</a><a id="Control-CellList-cell-size-1"></a><a class="docs-heading-anchor-permalink" href="#Control-CellList-cell-size" title="Permalink"></a></h2><p>The cell sizes of the construction of the cell lists can be controlled with the keyword <code>lcell</code> of the <code>ParticleSystem</code> constructor. For example:</p><pre><code class="language-julia-repl hljs">julia&gt; system = ParticleSystem(
           xpositions = rand(SVector{3,Float64},1000),
           unitcell=[1,1,1],
           cutoff = 0.1,
           output = 0.0,
           output_name = :energy,
           lcell=2,
       );</code></pre><p>Most times using <code>lcell=1</code> (default) or <code>lcell=2</code> will provide the optimal performance. For very dense systems, or systems for which the number of particles within the cutoff is very large, larger values of <code>lcell</code> may improve the performance. To be tested by the user.</p><div class="admonition is-info" id="Note-d45ff9362b7d97b8"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-d45ff9362b7d97b8" title="Permalink"></a></header><div class="admonition-body"><p>The number of cells in which the particles will be classified is, for each dimension <code>lcell*length/cutoff</code>. Thus if the <code>length</code> of the box is too large relative to the <code>cutoff</code>, many cells will be created, and this imposes a perhaps large memory requirement. Usually, it is a good practice to limit the number of cells to be not greater than the number of particles, and for that the cutoff may have to be increased, if there is a memory bottleneck. A reasonable choice is to use <code>cutoff = max(real_cutoff, length/n^(1/D))</code> where <code>n</code> is the number of particles and <code>D</code> is the dimension (2 or 3). With that the number of cells will be close to <code>n</code> in the worst case.</p></div></div><h2 id="Coordinates-as-matrices"><a class="docs-heading-anchor" href="#Coordinates-as-matrices">Coordinates as matrices</a><a id="Coordinates-as-matrices-1"></a><a class="docs-heading-anchor-permalink" href="#Coordinates-as-matrices" title="Permalink"></a></h2><p>Coordinates can also be provided as matrices of size <code>(D,N)</code> where <code>D</code> is the dimension (2 or 3) and <code>N</code> is the number of particles. For example:</p><pre><code class="language-julia hljs">using CellListMap
system = ParticleSystem(
    xpositions=rand(2,100),
    ypositions=rand(2,200),
    cutoff=0.1,
    unitcell=[1,1],
    output=0.0,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ParticleSystem2{output} of dimension 2, composed of:
    Box{CellListMap.OrthorhombicCell, 2}
      unit cell matrix = [ 1.0 0.0; 0.0 1.0 ]
      cutoff = 0.1
      number of computing cells on each dimension = [13, 13]
      computing cell sizes = [0.1, 0.1] (lcell: 1)
      Total number of cells = 169
    CellListMap.CellListPair{2, Float64}
       63 cells with real particles in reference set.
       90 cells with real particles in target set.
    Parallelization auxiliary data set for 8 batch(es).
    Type of output variable (output): Float64</code></pre><div class="admonition is-warning" id="Warning-84006dbee73a3286"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-84006dbee73a3286" title="Permalink"></a></header><div class="admonition-body"><p>This interface less flexible than when the coordinates are input as vectors of vectors, because <em>the number of particles</em> cannot be changed, because matrices cannot be resized. Otherwise, matrices can be used as input.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../updating/">« Updating the system</a><a class="docs-footer-nextpage" href="../examples/">Complete examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 10 February 2026 21:50">Tuesday 10 February 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
